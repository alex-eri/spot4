Spot 4.4.193 для Debian 8
=========================

Команды для установки
+++++++++++++++++++++

tar -C / -xf spot4-177.tar.gz 
apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 0C49F3730359A14518585931BC711F9BA15703C6
echo "deb http://repo.mongodb.org/apt/debian jessie/mongodb-org/3.4 main" | tee /etc/apt/sources.list.d/mongodb-org-3.4.list
apt-get update
apt-get install -y mongodb-org make sed
ln -s /opt/spot4/systemd/spot.service /etc/systemd/system/
ln -s /opt/spot4/systemd/spot.service /etc/systemd/system/multi-user.target.wants
systemctl enable spot
cp /opt/spot4/config/config.json.example /opt/spot4/config/config.json
nano /opt/spot4/config/config.json


Конфигурация
++++++++++++

"RADIUS_SECRET" : "testing123",
нужно сменить, прописывается в роутерах ваших.
Порты аккаунтинг, авторизация, хттп, хттпс. Можно оставить как есть, но для хттпс понадобится еще сертификат в '../config/server.pem'. Если сертификата нет, то лучше убрать эту строчку.
"ACCT_PORT":1813,
"AUTH_PORT":1812,
"HTTP_PORT":8080,
"HTTPS_PORT":8443,
"NETFLOW_PORT": 2055,
Убирайте строчку с нетфлоу. Оно только собирается в этой версии. Аналитики всеравно нет. Хотя можно оставить на будующее ;) 2100 ограничение таблички со статистикой.
"NETFLOW": [5],
"NETFLOW_SIZE": 2100,
Когда будете уверенны что все работает — переставьте в false и перезапустите:
"DEBUG": true,
Лог пишем в Journald. Или можно указать файлик. Ротации нет.
"LOGFILE": null,
Путь к базе данных обычно получается такой
"DB": {
	"SERVER": "mongodb://127.0.0.1:27017",
	"NAME":"spot4"
},

Ключик
++++++
Также в формате json в файл конфигурации добавить после первой "{".

"LIC": "Имя лецинзиата::gJQDr7FQzO2Wrsf5iLNu2EeMShO6NbLbzhNgt2YSEnRsf0Rxe9jKZZICNhsDtNeY0+0KgD3rjGoyjkKIjBgpUMbGVo0NF9Dcj/kJZZw5q1+oM/S0MAhplwsEpmWYCk3LKza76sgdv8gUsr8OFw7CTRyCDcVuOMipxTDrkA4qK1wTKr9GoAVovmkYYXg6uVJHrTAcHS0C5F1GBjSHg64RwpIAtFHiPLsO9ROa3bbJm8J+7ZhxI4jpxhbihjoqxNdIM4nHTFavxWVCeuEpDZSFppevIi7nOprl9MyaE/iIo86LOFX6JoeWMb9opbHLil5u5yxI2YfQgjR+cZqPxgfmSw==",



SMS рассылка.
+++++++++++++

Рабочие драйверы smstools,zte,http,redsms. Параметры такие…

Включает очереди приёма и отправки смс
			"sender": false,
			"reciever": false
zte путь к Вэб интерфейсу и номер телефона на симке:
			"url":"http://192.168.8.1",
			"number": "+79158190408",
HTTP: 
"method":"get", или post
Базовая урл запроса и параметры, например для smsc.ru
"url":"http://smsc.ru/sys/send.php",
"query":"login=<login>&psw=<password>&phones={phome}&mes={text}",
Логин и пароль забиваете в строчку, телефон и текст по шаблону
redsms немного с изворотом, поэтому отдельный драйвер
apikey, login указать параметрами, урлы сам соберет
smstools
"number": "+79158190408", номер для входящих смс.
Пути, если совпадают, можно не указывать:
"incomming":"/var/spool/sms/incoming"
"outgoing": "/var/spool/sms/outgoing"
"sentbox": "/var/spool/sms/sent"
"readbox":"/var/spool/sms/read"

Запуск
++++++

systemctl start spot

Лог смотреть journalctl -u spot -e -f

Настройка микротика
+++++++++++++++++++

Зайдите в папку /opt/spot4/mikrotik/. Выполните, указав ip адрес сервера:
make IP=10.254.0.1 PORT=8080
папку build/10.254.0.1 скопируйте на микротик

В настройках роутера

добавьте радиус. Галочка hotspot, таймаут от 1000 до 10000, ip сервака и секрет
Создайте бридж, на бридже адрес и дхчп, добавьте туда порт с точкой доступа.
Дхчп лучше создавать руками чем через мастер в хотспоте.

В разделе хотспот на вкладку profiles и добавьте профиль с параметрами:
hotspot-directory-override с указанием папки, которую закинули на микротик недавно.
Галочки http-chap, http-pap, mac. Куки убрать.
На вкладке радиус галочка use radius и укажите минут 10 в inheim update.
Сохраняем.
В walled garden ip добавьте строчку dst adress сервака, tcp, порт http.
На первой вкладке создаем хотспот. Интерфейсом выбираем бридж, профиль созданный выше. Укажите уникальное человекопонятное имя хотспоту.

Заходи на http://ip:port/admin/ и ввдели пароль и логин из конфига.
В разделе настройки щелкни на default и поставь переключатель зеленый на «не проверять номер» «пароль» в красное и выбирай тему. Лучше все выключатели поставить в красное или зеленое. Это настройки для ненастроенных хотспотов.
Дальше пробуй подключаться к хотспоту. Если все ОК, то отдельный раздел в натройках для него появится.

Доработка шаблонов
++++++++++++++++++

Доп файлы можно класть в папку data/ , они будут доступны по http://ip:port/data/file.jpg
сами шаблоны находятся в папке uam/theme/ скопируй одну из них и редактируй.
<div ng-view></div> должно присутствовать в месте для формы регистрации, остальное можно вырезать и изменять.
